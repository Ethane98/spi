#=================================================
# For COMMON
#=================================================

COMMON_FLAGS     = -fPIC -Werror -Wall
ifdef SP_RELEASE
  COMMON_FLAGS  += -DSP_RELEASE
endif

COMMON_IFLAGS     = -I$(SP_DIR)/h
COMMON_IFLAGS    += -I$(DYNINST_DIR)
COMMON_IFLAGS    += -I$(DYNINST_DIR)/common/h
COMMON_IFLAGS    += -I$(DYNINST_DIR)/dynutil/h
COMMON_IFLAGS    += -I$(DYNINST_DIR)/symtabAPI/h

COMMON_AR         = $(DYNINST_DIR)/proccontrol/$(PLATFORM)/libpcontrol.a \
                    $(DYNINST_DIR)/symtabAPI/$(PLATFORM)/libsymtabAPI.a \
                    $(DYNINST_DIR)/common/$(PLATFORM)/libcommon.a \
                    $(LIBXML) \
                    $(LIBDWARF) \
                    $(LIBELF)

COMMON_LDFLAGS   += -lpthread
UTILS_DIR         = $(SP_DIR)/src

#=================================================
# For Injector
#=================================================

IJ_DIR      = $(SP_DIR)/src/Injector

IJ_FLAGS   += $(COMMON_FLAGS)
IJ_FLAGS   += -D_GNU_SOURCE

IJ_LDFLAGS  = $(COMMON_LDFLAGS)

IJ_IFLAGS  += $(COMMON_IFLAGS)
IJ_IFLAGS  += -I$(DYNINST_DIR)/proccontrol/h
IJ_IFLAGS  += -I$(DYNINST_DIR)/proccontrol/src

IJ_AR       = $(COMMON_AR)

IJA_FLAGS   += -fPIC
IJA_LDFLAGS += -ldl -shared

#=================================================
# For Agent
#=================================================

AG_DIR      = $(SP_DIR)/src/Agent
VPATH      += $(AG_DIR)

AG_FLAGS   += $(COMMON_FLAGS)
AG_FLAGS   += -fPIC -Dos_linux -O0

AG_LDFLAGS  = $(COMMON_LDFLAGS)

AG_IFLAGS  += $(COMMON_IFLAGS)
AG_IFLAGS  += $(IJ_IFLAGS)
AG_IFLAGS  += -I$(DYNINST_DIR)/patchAPI/h
AG_IFLAGS  += -I$(DYNINST_DIR)/parseAPI/h
AG_IFLAGS  += -I$(DYNINST_DIR)/instructionAPI/h
AG_IFLAGS  += -I$(DYNINST_DIR)/stackwalk/h

AG_AR       = $(DYNINST_DIR)/patchAPI/$(PLATFORM)/libpatchAPI.a \
              $(DYNINST_DIR)/parseAPI/$(PLATFORM)/libparseAPI.a \
              $(DYNINST_DIR)/instructionAPI/$(PLATFORM)/libinstructionAPI.a \
              $(DYNINST_DIR)/stackwalk/$(PLATFORM)/libstackwalk.a \
              $(COMMON_AR) \
